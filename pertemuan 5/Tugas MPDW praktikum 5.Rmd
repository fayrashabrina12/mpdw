---
title: "MPDW Prak 5"
author: "Fayra Shabrina"
date: "2025-10-02"
output: html_document
---

```{r}
library(ggplot2)
library(tsibble)
library(tseries)
library(MASS)
```



```{r}
library(readxl)
data_mpdw <- read_excel("C:/Users/PNJ/OneDrive/Documents/Semester 5/mpdw 1/data.xlsx")
data_mpdw
```

```{r}
# Asumsikan kolom ke-2 adalah nilai daily_revenge
daily_revenge <- ts(data_mpdw[[2]])

head(daily_revenge)
```

```{r}
daily_revenge |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) + 
  geom_line(color="blue") + 
  theme_bw() +
  xlab("Observasi") + ylab("daily_revenge") +
  ggtitle("Plot Deret Waktu daily_revenge")
```
```{r}
lattice::densityplot(as.vector(daily_revenge))
```
Dari time series plot → data fluktuatif, ada indikasi trend & varians berubah → kemungkinan non-stasioner.

Dari density plot → distribusi tidak normal dan cenderung skewed

### Plot ACF
```{r}
acf(daily_revenge, main="Autocorrelation Function (ACF) daily_revenge")
```

### Uji ADF
```{r}
tseries::adf.test(daily_revenge)
```
$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Karena p-value (0.06624) > 0.05, maka pada taraf signifikansi 5% gagal menolak H₀ → data tidak stasioner.

### Plot Box-Cox

```{r}
# Model linear
model <- lm(daily_revenge ~ seq_along(daily_revenge))

# Box-Cox Transformation
bc <- boxcox(model, lambda = seq(-1, 4, 0.01))

# Nilai lambda optimal
lambda_opt <- bc$x[which.max(bc$y)]
cat("Lambda optimal:", lambda_opt, "\n")

# Rentang lambda dalam CI 95%
lambda_ci <- range(bc$x[bc$y > max(bc$y) - 1/2 * qchisq(.95, 1)])
cat("Rentang lambda (95% CI):", lambda_ci, "\n")
```

## Penanganan Ketidakstasioneran dalam Ragam dan Rataan
### Transformasi ragam (Box-Cox) untuk stabilkan ragam
```{r}
daily_revenge_bc <- 1/daily_revenge 
```

### Plot hasil transformasi
```{r}
daily_revenge_bc |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) + 
  geom_line(color="red") +
  theme_bw() +
  xlab("Observasi") + ylab("Kurs USD (Box-Cox λ=0.42)") +
  ggtitle("Transformasi Box-Cox (λ = 0.42)")
```

###  Differencing (orde 1) untuk stabilkan rataan
```{r}
daily_revenge_diff <- diff(daily_revenge_bc, differences = 1)
```

### Plot hasil differencing
```{r}
daily_revenge_diff |> ts() |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) + 
  geom_line(color="darkgreen") +
  theme_bw() +
  xlab("Observasi") + ylab("Kurs USD (Box-Cox & Differencing)") +
  ggtitle("Transformasi Box-Cox + Differencing Orde 1")
```

### Uji ADF ulang setelah transformasi
```{r}
adf_test <- tseries::adf.test(na.omit(daily_revenge_diff))
adf_test
```

### ACF dan PACF setelah transformasi
```{r}
acf(na.omit(daily_revenge_diff), main="ACF Setelah Box-Cox & Differencing")
pacf(na.omit(daily_revenge_diff), main="PACF Setelah Box-Cox & Differencing")
```
Berdasarkan hasil ADF test (p-value < 0.05) dan ACF/PACF setelah Box-Cox & differencing, data daily_revenge sudah stasioner baik dalam rataan maupun ragam